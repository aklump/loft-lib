<!DOCTYPE html>

<html>
<head>
  <title>Dataset</title>
  <link href="search/tipuesearch.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>

<body class="page--dataset">
<header>
  <div class="pager">
  <a href="README.html" class="prev README">&laquo;In the Loft Studios Library</a>
  <a href="index.html" class="index">Index</a>
  <a href="_tasklist.html" class="next _tasklist">Tasklist&raquo;</a>
</div>
</header>

  <div class="search__wrapper">
  <form action="search--results.html">
    <input type="text" class="search-input" name="q" id="tipue_search_input" autocomplete="off" required>
  </form>
</div>

  <h1>Dataset</h1>
  <div class="breadcrumb"><a href="index.html">Index</a></div>

<section>

<h2>Quick Start</h2>

<ol>
<li><p>First create a class that extends <code>Dataset</code>. It must implement these protected methods, which define the schema of the dataset.</p>

<ol>
<li>acceptKeys</li>
<li>requireKeys</li>
<li>describe</li>
<li>defaults</li>
<li>types</li>
<li>match</li>
</ol></li>
<li><p>Then implement an instance in your code like this:</p>

<pre><code>&lt;?php
$data = ['id' =&gt; 123];
...
try {
    $timer = Timer::dataset($data)-&gt;validate()-&gt;throwFirstProblem();
  } catch (\Exception $exception) {
    // Do something if validation failed.
}
</code></pre></li>
</ol>

<h2>Accessing Data</h2>

<ol>
<li>Get the complete dataset as an array (sorted, with defaults, etc): <code>$array = $data-&gt;get()</code></li>
<li>Get the JSON value of the dataset by casting to a string: <code>$json = strval($data)</code>.</li>
<li>Use a property directly: <code>$id = $data-&gt;id</code></li>
<li>Use a property's alias directly: <code>$id = $data-&gt;userId</code>.  Read about aliases for more info.</li>
</ol>

<h2>Accessing Defaults</h2>

<ol start="5">
<li>Get the default for single key: <code>Timer::getDefault('id')</code>.</li>
<li>Get an array of defaults: <code>Timer::getDefaults()</code></li>
</ol>

<h2>Detecting Errors</h2>

<ol>
<li>Return an array of all: <code>$data-&gt;getProblems</code>.</li>
<li>Throw an <em>\InvalidArgumentException</em> with the first problem: <code>$data-&gt;throwFirstError</code></li>
</ol>

<h2>Setting Data</h2>

<ul>
<li>You cannot set data directly.</li>
<li>You must do an new import, following a get.</li>
</ul>

<h2>Aliases</h2>

<p>@todo</p>

<h2>Custom Validation</h2>

<ol>
<li>If you have advanced validation beyond what comes for free, you may extend <code>validate()</code>, but read the docs there for what needs to happen.</li>
<li>Consider using <code>ignoreKey()</code> instead, if possible.</li>
</ol>

<h2>How to Ignore a Key in Your Dataset (so as to not cause validation error)</h2>

<pre><code>protected static function ignoreKey($key)
{
    return $key === 'duration';
}

protected static function ignoreKey($key)
{
    return strpos($key, '#') === 0;
}
</code></pre>

<h2>Notes</h2>

<ul>
<li>To ignore some keys use <code>static::ignoreKey()</code> in your class.</li>
</ul>

<h2>Advanced Usage</h2>

<h3>Auto-generate Values: Example 1</h3>

<p>The time to do this is during <code>::import</code>.</p>

<pre><code>&lt;?php

/**
 * Import extra data based on a default value.
 *
 * In this example, the defaults set the user id by global var.  During import
 * we check for a user_id, either by import $data or the default data.  Then we
 * make sure the the $original import data doesn't contain session_id, and if
 * so we pull that data from the user account object.
 */
class Alpha extends Dataset {

  ... 

  /**
   * {@inheritdoc}
   */
  protected static function defaults() {
    global $user;

    return [
      'user_id' =&gt; $user-&gt;uid,
      'session_id' =&gt; -1,
    ];
  }

  /**
   * {@inheritdoc}
   */
  public function import($data) {
    $original = $data;
    $data += static::getDefaults();

    // Figure the session id based on the last time the user logged in.
    // https://amplitude.zendesk.com/hc/en-us/articles/115002323627-Sessions
    if ($data['user_id'] &amp;&amp; empty($original['session_id'])) {
      $account = user_load($data['user_id']);

      // We will count our session based on last login.
      // https://drupal.stackexchange.com/questions/21864/whats-the-difference-between-user-login-and-access#21873
      $data['session_id'] = $account-&gt;login * 1000;
    }

    return parent::import($data);
  }

}
</code></pre>
</section>

<div class="search__results">
  <div id="tipue_search_content"></div>
</div>

<footer>
  <div class="pager">
  <a href="README.html" class="prev README">&laquo;In the Loft Studios Library</a>
  <a href="index.html" class="index">Index</a>
  <a href="_tasklist.html" class="next _tasklist">Tasklist&raquo;</a>
</div>
  
  <div id="footer-legaleeze">
    <p class="legaleeze center">Version: 1.0 &bull; Last Updated: Sun, 07 Oct 2018 11:47:14 -0700</p>
  </div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="search/tipuesearch_content.js"></script>
  <script src="search/tipuesearch_set.js"></script>
  <script src="search/tipuesearch.min.js"></script>
  <script>
    $(document).ready(function () {
      $('#tipue_search_input').tipuesearch();
    });
  </script>
<script src="js/core.js"></script>
</body>
</html>

